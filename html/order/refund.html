<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>退款</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/common.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/animate.css" />
		<style>
			/*购买项目*/
			
			.block2 .proPic {
				width: 80px;
				height: 80px;
				overflow: hidden;
				margin-right: 15px;
			}
			.cellInputArea{
				min-height: 150px;
			}
		</style>
	</head>

	<body>
		<div id="app">
			<header class="fixed  header flex" id="header">
				<button class="mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left cor_w"><span class="mui-icon mui-icon-left-nav "></span>返回</button>
				<div class=" f1  cor_w t_c page_title">
					退款申请
				</div>
				<button class=" mui-btn  mui-btn-link mui-btn-nav mui-pull-right cor_w">
					须知				
				</button>
			</header>

			<!--订单内容-->
			<div ref='scroll' class="scrollBox" :style="{top:appHeight+'px'}">
				<div class="clearfix scrollContent">

					<!--项目-->
					<div class="panelPad block2">
						<div class="pro flex">
							<div class="proPic">
								<img :src="order.PROJECT_IMG1" alt="" class="cover" />
							</div>
							<div class="f1">
								<div class="fs16">{{order.PROJECT_NAME}} </div>
								<p>技师：{{order.SHOP_NAME}} </p>
								<p class="flex">嘿皮值:
									<img src="../../images/levelicon.png" alt="" class="cm_level" v-for="item in  levels " />
								</p>
								<div>
									交易金额：<span class="cor_r fs16 lh30">￥{{order.ORDER_TOTAL_AMOUNT}} </span> 
								</div>
							</div>
							
						</div>

					</div>

					<!--备注-->
					
					<div class="panel  block3">
						<div class="">
							<ul class="mui-table-view mui-table-view-radio">
								<li class="mui-table-view-cell mui-selected" @tap="_reason('多买/买错/不想要')">
									<a class="mui-navigate-right ">多买/买错/不想要</a>
								</li>
								<li class="mui-table-view-cell " @tap="_reason('服务时间对不上')">
									<a class="mui-navigate-right">服务时间对不上</a>
								</li>
								<li class="mui-table-view-cell" @tap="_reason('临时有事')">
									<a class="mui-navigate-right">临时有事</a>
								</li>
								<li class="mui-table-view-cell" @tap="_reason('联系不上技师')">
									<a class="mui-navigate-right">联系不上技师</a>
								</li>
								<li class="mui-table-view-cell " @tap="_reason('服务态度极差')">
									<a class="mui-navigate-right">服务态度极差</a>
								</li>
								<li class="mui-table-view-cell" @tap="_reason('作品有损坏')">
									<a class="mui-navigate-right">作品有损坏</a>
								</li>
							</ul>
						</div>
						<div class="mui-table-view">							
							<div class="mui-table-view-cell">
								<p class="cm_name">退款原因</p>
								<textarea class="cellInputArea" v-model="remark" placeholder="请输入退款原因"></textarea>
							</div>
						</div>
					</div>

				</div>
			</div>
			<!--模态框1-->

			<!--底部菜单-->
			<div class="cm_bottomBtn flex">
				<div class="f1" style="line-height: 50px;">
					退款金额：<span class="cor_r fs20">￥{{order.ORDER_TOTAL_AMOUNT}}</span>
				</div>

				<div class="f1 yesBtn" @tap="_toSubmit">
					确认提交
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/vue.js"></script>
		<script src="../../js/bscroll.min.js"></script>
		<script src="../../js/aes.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			mui.init({
				swipeBack: true
			});
			var APP;
			mui.plusReady(function() {
				app.WXinit(CryptoJS)
				APP = new Vue({
					el: '#app',
					data: {
						tabContenTop: '',
						scroll: '',
						isLoading: false,

						appHeight: '',

						orderCode: '',

						levels: 0,
						/*表单需要提交*/
						product: '',
						/*订单详情*/
						order: '',
						remark: '多买/买错/不想要', //原因
	
						reason:0
					},
					created: function() {
						app.initHeader();
						var self = plus.webview.currentWebview();
						this.orderCode = self.orderCode

					},
					mounted: function() {
						var _this = this;

						var scroll = this.$refs.scroll
						//						var wraper = this.$refs.wraper
						//							初始化scroll的屏幕位置
						this.appHeight = document.getElementById('header').offsetHeight;
						/*初始化数据*/
						this._getData(() => {
							//							alert(3)
							plus.nativeUI.closeWaiting()
							mui.currentWebview.show('pop-in', 300, function() {}, {});
						})
					},
					methods: {

						/*选择原因*/
						_reason(txt){
//							alert(txt)
							this.remark = txt
						},
						/*获取数据*/
						_getData(callback) {
							var _this = this
							//							alert(1)
							/*获取订单详情*/
							app.ajax(app.baseUrl + '/api/OrderService/GetOrder', {
								type: 'get', //HTTP请求类型
								data: {
									ORDER_CODE: _this.orderCode
								},
								success: function(result) {
									if(result.Success) {
										_this.order = result.Data.data;
										_this.levels = parseInt(result.Data.data.SHOP_STAR)
										if(callback) callback()
									} else {
										/*验证失败*/
										plus.nativeUI.toast(result.Msg)
										if(callback) callback()
									}
								}
							});

						},

						/*提交订单*/
						_toSubmit() {
							var _this = this

							/*订单信息判断*/
							if(!this.remark ) {
								plus.nativeUI.alert("请输入退款原因", function() {}, '马嘿嘿提醒您');
								return;
							} 
							
							plus.nativeUI.showWaiting()
							var data = {
								ORDER_CODE: _this.orderCode,
								reason: _this.remark
							}

							app.ajax(app.baseUrl + '/api/Order/ApplyRefundOrder', {
								type: 'post', //HTTP请求类型
								data: data,
								success: function(result) {
									plus.nativeUI.closeWaiting()

									if(result.Success) {
										plus.nativeUI.toast('您的申请，已经提交审核')
										plus.webview.getWebviewById('orders').evalJS('refresh()')
										 
										mui.later(()=>{
											mui.back()
										},1000)
										
										/*成功跳转支付页面*/

									} else {
										/*验证失败*/
										plus.nativeUI.toast(result.Msg)
									}
								}
							});

						},
						/*跳转地址管理*/
						_address() {
							mui.openWindow({
								url: '../address/address.html',
								id: "address",
								styles: {
									top: '0px', //新页面顶部位置
									bottom: '0px', //新页面底部位置
									scrollIndicator: "none",
									plusrequire: 'ahead'
								},
								createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
								show: {
									autoShow: false, //页面loaded事件发生后自动显示，默认为true
									duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
								},
								waiting: {
									autoShow: true, //自动显示等待框，默认为true
									title: '正在加载...', //等待对话框上显示的提示内容
								}
							})

							this._modelToggle()
						}
					}
				})

			});

			function hasTime(date) {
				//				alert(new Date(date) )
				let time = new Date(date)
				//				alert(date+time)
				if(date) {
					/*如果有回传选择的日期*/
					//					alert(666)
					APP._orderTime(time)
				}
				var self = plus.webview.currentWebview();
				self.setStyle({
					mask: 'none'
				});
			}
		</script>
	</body>

</html>