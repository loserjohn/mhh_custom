<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>用户实名认证</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/common.css" />
		<link rel="stylesheet" href="../css/iconfont.css" />
		<link rel="stylesheet" href="../css/animate.css" />
		<style>
			.block1{
				background: #fff;
			}
			.block2 .cellInputTxt {
				width: 100%;
				border: none;
				outline: none;
				margin: 0;
				padding: 0;
				text-align: right;
				height: auto;
				font-size: 14px;
			}
			
		</style>
	</head>

	<body>
		<div id="app">

			<!--订单内容-->
			<div id="content">
				<div class="clearfix ">
					<!--项目-->
					<div class="panelPad block1">
						<p>您当前：</p>
						<h3 class="cor_y lh36">{{realStatus | status}}</h3>
					</div>

					<!--备注-->
					<div class="panel  block2">
						<!--问题图片-->
						<ul class="mui-table-view">
							<li class="mui-table-view-cell flex">
								<div class="f1 cellName">真实姓名</div>
								<div class="f1">
									<input type="text" class="cellInputTxt t_r " v-model="realname" placeholder="请输入真实姓名"  />
								</div>
							</li>
							<li class="mui-table-view-cell flex">
								<div class="f1 cellName">身份证件号码</div>
								<div class="f1">
									<input type="text" class="cellInputTxt t_r " v-model="idCard" placeholder="请输入证件号码"  />
								</div>
							</li>
							<li class="mui-table-view-cell ">
								<div class=" cellName">身份证正面:</div>
								<div class="f1" @tap = "_getPic(1)">
									<img :src="idCardZM?idCardZM:'../images/sfz_z.png'" alt=""  class="contain"/>
								</div>
							</li>
							<li class="mui-table-view-cell ">
								<div class=" cellName" >身份证反面:</div>
								<div class="f1" @tap = "_getPic(2)">
									<img :src="idCardFM?idCardFM:'../images/sfz_f.png'" alt="" class="contain"/>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!--模态框1-->

			<!--底部菜单-->
			<div class="container " style="padding-bottom: 10px;">
				<div class="cm_btn" @tap="_toSubmit"  >
					提交认证
				</div>
				<!--<div class="cm_btn" @tap="_toSubmit" v-if="realStatus==0" >
					提交认证
				</div>
				<div class="cm_btn" @tap="_toSubmit" v-if="realStatus!=0 && realStatus!=2" >
					确认修改
				</div>-->
				<!--<div class="cm_btn_disabled" v-if="realStatus==2" >
					审核中...
				</div>-->
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/vue.js"></script>
		<script src="../js/bscroll.min.js"></script>
		<script src="../js/aes.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			mui.init({
				swipeBack: true
			});
			var APP;
			mui.plusReady(function() {
				app.WXinit(CryptoJS)
				APP = new Vue({
					el: '#app',
					data: {
						realStatus: 0,
						isLoading: false,
						
						realname:'',
						idCard:'',
						idCardZM:'',
						idCardFM:''
					},
					created: function() {
						var s = parseInt(plus.storage.getItem('realStatus'))
						this.realStatus = s
						
						this._getData()
					},
					filters: {
						status(value) {
							switch(value) {
								case 0:
									return '尚未认证'
									break;
								case 1:
									return '已通过认证'
									break;
								case 2:
									return '认证中'
									break;
								case 3:
									return '认证失败'
									break;
								case 4:
									return '冻结'
									break;
								case 5:
									return '注销'
									break;
								default:
									break;
							}
						}
					},
					mounted: function() {
						/*初始化数据*/
					},
					methods: {
//						初始化数据
						_getData(callback){
							var _this = this
							app.ajax(app.baseUrl + '/api/MemberInfo/GetMemberInfo', {
								type: 'get', //HTTP请求类型
								success: function(result) {
									if(result.Success) {
										_this.userMsg = result.Data
										//										alert(result.Data.MEMBER_HEAD)
										_this.realname = result.Data.MEMBER_REALNAME
										_this.idCard = result.Data.CARD_NUM
										_this.idCardZM = result.Data.PIC_IDCARD1
										_this.idCardFM = result.Data.PIC_IDCARD2
//										console.log(result.Data.PIC_IDCARD1)
//											console.log(result.Data.PIC_IDCARD2)
										if(callback) callback()
									} else {
										plus.nativeUI.closeWaiting();
										plus.nativeUI.toast(result.Msg)
									}
								}
							});
						},
						//						获取问题图片
						_getPic(k) {
							var _this = this
							app.getIMG('上传图片', function(src) {
								switch (k){
									case 1:
									_this.idCardZM = src
										break;
									default:
									_this.idCardFM = src
										break;
								}								
							})
						},

						/*提交认证*/
						_toSubmit() {
							var _this = this

							/*订单信息判断*/
							if(!this.realname || !this.idCard || !this.idCardZM || !this.idCardFM ) {
								plus.nativeUI.alert("请完善信息", function() {}, '马嘿嘿提醒您');
								return;
							}
							/*订单信息判断*/
							plus.nativeUI.showWaiting()
							
							var data = {
								MEMBER_REALNAME:this.realname,
								CARD_NUM:this.idCard,
								PIC_IDCARD1:this.idCardZM,
								PIC_IDCARD2:this.idCardFM
							}
							console.log(JSON.stringify(data))
							app.ajax(app.baseUrl + '/api/MemberInfo/UpdateMemberInfo', {
								type: 'post', //HTTP请求类型
								data: data,
								success: function(result) {
									plus.nativeUI.closeWaiting()

									if(result.Success) {
										plus.nativeUI.toast('您的申请，已经提交审核')

										plus.webview.getWebviewById('mine').evalJS('refresh()')
										if(plus.webview.getWebviewById('set')){
											plus.webview.getWebviewById('set').close()
										}
										
										mui.back()

										/*成功跳转支付页面*/

									} else {
										/*验证失败*/
										plus.nativeUI.toast(result.Msg)
									}
								}
							});

						},
						/*跳转地址管理*/
						_address() {
							mui.openWindow({
								url: '../address/address.html',
								id: "address",
								styles: {
									top: '0px', //新页面顶部位置
									bottom: '0px', //新页面底部位置
									scrollIndicator: "none",
									plusrequire: 'ahead'
								},
								createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
								show: {
									autoShow: false, //页面loaded事件发生后自动显示，默认为true
									duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
								},
								waiting: {
									autoShow: true, //自动显示等待框，默认为true
									title: '正在加载...', //等待对话框上显示的提示内容
								}
							})

							this._modelToggle()
						}
					}
				})

			});

			function hasTime(date) {
				//				alert(new Date(date) )
				let time = new Date(date)
				//				alert(date+time)
				if(date) {
					/*如果有回传选择的日期*/
					//					alert(666)
					APP._orderTime(time)
				}
				var self = plus.webview.currentWebview();
				self.setStyle({
					mask: 'none'
				});
			}
		</script>
	</body>

</html>