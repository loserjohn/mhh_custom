<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>首页</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no, viewport-fit=cover" />
		<link href="./css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="./css/common.css" />
		<link rel="stylesheet" href="./css/iconfont.css" />
		<style>
			.curPos {
				line-height: 36px;
				height: 36px;
				border: 1px solid #444;
				background: rgba(0, 0, 0, .5);
				border-radius: 18px;
				padding: 0 10px;
				margin-right: 10px;
				margin-top: 4px;
			}
			
			.curPos>div {
				margin: 0 5px;
				max-width: 120px;
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
			}
			
			.message {
				padding-top: 4px;
			}
			
			.message i {
				font-size: 20px;
				line-height: 40px;
				margin: 0 10px;
			}
			/*轮播图*/
			
			.carouselBox {
				/*border-radius: 0 0 20px 20px;*/
				overflow: hidden;
			}
			
			.carouselBox .mui-slider-indicator {
				position: absolute;
				bottom: 12px!important;
				z-index: 1000;
			}
			/*菜单*/
			
			.menus {
				/*border-radius: 20px 20px 0 0;*/
				background: #fff;
				margin-top: -10px;
				overflow: hidden;
				position: relative;
				z-index: 999;
				/*background-image:url(./images/bg1111.jpg);*/
				background-position: center;
				background-size: cover;
				background-repeat: no-repeat;
			}
			
			.menus ul {
				width: 100%;
				justify-content: space-around;
				flex-wrap: wrap;
			}
			
			.menusItem {
				width: 25%;
				height: 80px;
				text-align: center;
				margin-top: 5px;
				padding: 5px;
			}
			
			.menusItem a {
				text-align: center;
				width: 100%;
				height: 100%;
				display: block;
			}
			
			.menusItem a p {
				font-size: 12px;
				color: #fff
			}
			/*红包*/
			
			.block1 {
				width: 100%;
				background: #fff;
				height: 118px;
			}
			
			.block1>img {
				height: 100%;
				/*margin-top: -10px;*/
			}
			
			.block1 .block1_txt {
				line-height: 1.5;
				font-size: 16px;
				text-align: right;
				margin-top: 10px;
			}
			/*特惠*/
			
			.block2 {
				margin-top: 6px;
				background: #fff
			}
			/*活动*/
			
			.block3 {
				margin-top: 6px;
			}
			
			.block3>img {
				width: 100%;
				height: auto;
			}
			
			.activityBox {
				box-sizing: border-box;
				padding: 10px;
				width: 100%;
				/*overflow: hidden;*/
				position: relative;
				height: 170px;
			}
			
			.activityBox::before {
				content: "";
				position: absolute;
				top: -30px;
				right: 15px;
				width: 0;
				height: 0;
				z-index: 10;
				/*background: red;*/
				border: 10px solid transparent;
				border-bottom: 15px solid #fff;
			}
			
			.activityBox .activityItem {
				width: 100px;
				box-sizing: border-box;
				/*padding: 5px;*/
				overflow: hidden;
				/*border-radius: 5px;*/
				/*margin: 0 5px;*/
				padding: 5px;
				/*background: red;*/
			}
			
			.activityBox .activityItem>img {
				width: 100%;
				height: 80px;
			}
			
			.activityBox .more {
				border: 1px solid #eee;
				box-sizing: border-box;
				height: 100%;
				text-align: center;
			}
			
			.activityBox .more span {
				margin-top: 20px;
				font-size: 40px;
				color: #d3d3d3;
			}
			/*今日上新*/
			
			.block4 .cm_title {
				border-bottom: 1px dotted #d3d3d3;
				line-height: 40px;
				margin-top: 6px;
			}
			
			.block4 .newContent>ul {
				width: 100%;
				flex-wrap: wrap;
			}
			
			.block4 .newItem {
				width: 50%;
				box-sizing: border-box;
				padding: 5px;
				margin-top: 5px;
				border-radius: 5px;
				position: relative;
				/*overflow: hidden;*/
			}
			
			.block4 .newItem .shopAvatar {
				width: 32px;
				height: 32px;
				overflow: hidden;
				border-radius: 50%;
				margin-right: 10px;
			}
			
			.block4 .newItem .shopAvatar img {
				width: 100%;
				height: 100%;
			}
			
			.block4 .newItem .activityTool {
				position: absolute;
				left: 0;
				top: 20px;
				height: 18px;
				border: 1px solid #bc890c;
				padding: 0 10px;
				font-size: 10px;
				line-height: 16px;
				background: #f1ca5d;
				border-radius: 3px;
				color: #ab5a0b;
			}
			
			.block4 .newItem img {
				width: 100%;
				height: 150px;
			}
			
			.mainBox {
				position: absolute;
				width: 100%;
				left: 0;
				top: 0;
				/*background: red;*/
			}
			
			.cm_level {
				width: 14px!important;
				height: 14px!important;
			}
			
			.backTop{
				width: 40px;
				height: 40px;
				/*border-radius: 50%;*/
				position: fixed;
				bottom: 80px;
				right: 20px;
				
			}
			.backTop>img{
				border-radius: 50%;
				box-shadow: 0 0 4px #ccaa42;
				animation:rot 4s infinite;
			}
			@keyframes rot{
				from{ transform: rotate(0);}
				to{transform: rotate(360deg);}
			}
		</style>
	</head>

	<body>
		<div id="app">
			<!--头部-->
			<header class="fixed container header flex " :style="{background:'rgba(21,21,21,'+opacity+')'}" id="header">
				<div class="curPos flex" @tap="_NTnavigateTo('./html/address/where.html','where')">
					<i class="iconfont icon-wei- cor_y fs16"></i>
					<div class="cor_w f1">{{curPos}}</div>
					<i class="iconfont icon-xiayibu cor_w"></i>
				</div>
				<div class="cm_search f1 flex" @tap="_NWnavigateTo('./html/production/search.html','search')">
					<i class="iconfont icon-search cor_g"></i>
					<div class="f1 cm_search_input ">马嘿嘿带你搜点啥？</div>
				</div>
			</header>
			<div ref='scroll' class="mainBox" :style="{height:appHeight+'px'}">
				<div class="clearfix scrollContent ">
					<!--刷新提示框-->
					<div class="refresh flex">
						<div class="flex " style="bottom:110px ;">
							<p class="f2 t_r "></p>
							<!--<i class="iconfont icon-hua cor_y"></i>-->
							<p class="f1 t_l">有种你放开我</p>
						</div>
						<div class="flex " style="bottom:80px ;">
							<p class="f1 t_r">有种你放开我</p>
							<!--<i class="iconfont icon-dianzan1 cor_y"></i>-->
							<p class="f2 t_l"></p>
						</div>
						<div class="flex " style="bottom:50px ;">
							<p class="f2 t_r"></p>
							<!--<i class="iconfont icon-zuanshi cor_y"></i>-->
							<p class="f1 t_l">有种你放开我</p>
						</div>
						<div class="flex " style="bottom:20px ;">
							<p class="f1 t_r">有种你放开我</p>
							<!--<i class="iconfont icon-jiangbei cor_y"></i>-->
							<p class="f2 t_l"></p>

						</div>
						<img src="./images/index/refresh1.png" class="refreshImg" />
					</div>
					<!--主页面信息-->
					<div class="relative">
						<!--轮播图部分-->
						<div class="carouselBox ">
							<div id="slider" class="mui-slider" ref='slider'>
								<div class="mui-slider-group mui-slider-loop" style="min-height: 150px;">
									<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
									<div class="mui-slider-item mui-slider-item-duplicate" @tap="_jump(prevPic.LINK_URL)">
										<img :src="prevPic.LINK_IMAGE" >
										<!--<img src="images/index/banner2.png" class="lazy" :data-src="prevPic.LINK_IMAGE">-->
									</div>
									<!-- 第一张 -->
									<div class="mui-slider-item" v-for="item in activityPics" @tap="_jump(item.LINK_URL)">
										<img :src="item.LINK_IMAGE" class="lazy" >
										<!--<img src="images/index/banner2.png" class="lazy" :data-src="item.LINK_IMAGE">-->
									</div>
									<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
									<div class="mui-slider-item mui-slider-item-duplicate" @tap="_jump(nextPic.LINK_URL)">
										<img :src="nextPic.LINK_IMAGE">
										<!--<img src="images/index/banner2.png" class="lazy" :data-src="nextPic.LINK_IMAGE">-->
									</div>
								</div>
								<div class="mui-slider-indicator">
									<div class="mui-indicator " v-for="(item,index) in activityPics" :class="{'mui-active':index==0}"></div>
								</div>
							</div>
						</div>

						<!--分类按钮-->
						<div class="menus " :style="{backgroundImage:menusBackgroundPic}">
							<ul class="flex">
								<li class="menusItem" v-for="(item,index) in menusList" @tap="_menuTo(item.type,item.text)">
									<a href="####">
										<img :src="item.backgroundPic"  width="50" />
										<!--<img :src="'images/index/ic'+index+'.png'" class="lazy" :data-src="item.backgroundPic" width="50">-->
										<p>{{item.text}}</p>
									</a>
								</li>

							</ul>
						</div>

						<!--导航栏豆腐块-->
						<div v-for="item in blockData" class="block2">
							<div class=" flex " v-if="item.type==1">
								<div class="f1 t_c" @tap="_jump(item.listData[0].keyCode)">
									<img :src="item.listData[0].img" alt="" class="contain " />
									<!--<img src="images/block.png" class=" contain lazy" :data-src="item.listData[0].img">-->
								</div>
							</div>
							<div class=" flex " v-else-if="item.type==2">
								<div class="f1 t_c" @tap="_jump(item.listData[0].keyCode)">
									<img :src="item.listData[0].img" alt="" class="contain " />
									<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[0].img">-->
								</div>
								<div class="f1 t_c" @tap="_jump(item.listData[1].keyCode)">
									<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[1].img">-->
									<img :src="item.listData[1].img" alt="" class="contain" />
								</div>
							</div>

							<div class="flex " v-else-if="item.type==3">
								<div class=" f2">
									<div class="f1 t_c" @tap="_jump(item.listData[0].keyCode)">
										<img :src="item.listData[0].img" alt="" class="contain" />
										<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[0].img">-->
									</div>

								</div>
								<div class="f3 ">
									<div class=" t_c" @tap="_jump(item.listData[1].keyCode)">
										<img :src="item.listData[1].img" alt="" class="contain" />
										<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[1].img">-->
									</div>
									<div class=" t_c" @tap="_jump(item.listData[2].keyCode)">
										<img :src="item.listData[2].img" alt="" class="contain" />
										<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[2].img">-->
									</div>
								</div>
							</div>
							<div class=" flex " v-else-if="item.type==4">
								<div class="f1 t_c" @tap="_jump(item.listData[0].keyCode)">
									<!--<img :src="item.listData[0].img?item.listData[0].img:'./images/index/refresh1.png'" alt="" class="contain " />-->
									<img :src="item.listData[0].img?item.listData[0].img:'./images/index/refresh1.png'" alt="" class="contain " />
									<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[0].img">-->
								</div>
								<div class="f1 t_c">
									<div class="" @tap="_jump(item.listData[1].keyCode)">
										<img :src="item.listData[1].img?item.listData[1].img:'./images/index/index1.png'" alt="" class="contain" />
										<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[1].img">-->
									</div>
									<div class="flex">
										<div class="f1 t_c" @tap="_jump(item.listData[2].keyCode)">
											<img :src="item.listData[2].img?item.listData[2].img:'./images/index/index1.png'" alt="" class="contain " />
											<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[2].img">-->
										</div>
										<div class="f1 t_c" @tap="_jump(item.listData[3].keyCode)">
											<img :src="item.listData[3].img?item.listData[3].img:'./images/index/index1.png'" alt="" class="contain" />
											<!--<img src="images/block.png" class="contain lazy" :data-src="item.listData[3].img">-->
										</div>
									</div>
								</div>
							</div>

						</div>

						<!--推荐活动-->
						<div class="block3  panel" v-for="(item,index) in  recommend" v-show="item.Items.length>1">
							<img :src="item.TYPE_IMAGE?item.TYPE_IMAGE:'./images/index/index3.png'" alt="" class="contain" />
							<!--<img src="images/index/banner3.png" class="contain lazy" :data-src="item.TYPE_IMAGE">-->
							<div class="mui-scroll-wrapper activityBox " :id="'wrapper'+index">
								<ul class="reset flex mui-scroll " :style="{width:100*(item.Items.length+1)+'px'}">
									<li class="activityItem " v-for="list in item.Items" @tap="_NWnavigateTo('./html/production/productBuy.html','productBuy',{proKey:list.PROJECT_CODE})">
										<img :src="list.PROJECT_IMG1" alt="" class="contain" />
										<aside class="cm_name">{{list.PROJECT_NAME}}</aside>
										<article class="flex">
											<p class="prize  cor_r fs14 lh28">￥{{list.IS_ACTIVITY==1?list.ACTIVITY_PRICE:list.PROJECT_DISCOUNT}}</p>
											<p class="delec_prize  fs12 cor_g f1 t_r lh28">￥{{list.PROJECT_PRICE}}</p>
										</article>
									</li>

									<li class="activityItem " @tap="_menuTo('1',item.TYPE_NAME)">
										<div class="more">
											<span class="mui-icon mui-icon-plusempty lh36"></span>
											<div class="cor_g fs12">查看<br>更多</div>
										</div>
									</li>
								</ul>
							</div>
						</div>

						<!--今日上新-->
						<div class="block4  panel container">
							<div class="cm_title t_c">
								-- 今日上新 --
							</div>
							<div class="newContent">
								<ul class="reset flex">
									<li class="newItem" v-for="item in newst" @tap="_NWnavigateTo('./html/production/productBuy.html','productBuy',{proKey:item.PROJECT_CODE})">
										<img :src="item.PROJECT_IMG1" alt="" />
										<aside class="cm_name">{{item.PROJECT_NAME}}</aside>
										<article class="flex">
											<p class="prize  cor_r fs18 lh28" style="margin-right: 10px;">￥{{item.IS_ACTIVITY==1?item.ACTIVITY_PRICE:item.PROJECT_DISCOUNT}}</p>
											<p class="delec_prize cor_g f1  lh28">￥{{item.PROJECT_PRICE}}</p>
										</article>
										<div class="flex">
											<aside class="shopAvatar">
												<img :src="item.SHOP_LOGO?item.SHOP_LOGO:'./images/default_avatar.jpg'" @error="_default" class="cover" />
											</aside>
											<div class="f1">
												<p>{{item.SHOP_NAME}}</p>
												<div class="flex">
													<img src="./images/levelicon.png" alt="" class="cm_level" v-for="product in  (parseInt(item.SHOP_STAR))" />
												</div>
											</div>
										</div>
										<div class="activityTool">{{item.PROJECT_CLASS}}</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<!--提示语-->
					<div class="cm_hint flex">
						<div class="f1"><img src="./images/hint.png" alt="" /></div>
					</div>
				</div>
			</div>
			<!--升级遮罩-->
			<div id="noNet" class="cm_version flex" v-if="noNet">
				<div style="width: 100vw;height:100vh;background: #fff;">
					<img src="images/noLogin.png" alt="" width="60" height="60" class="versionLoad" />
					<div class="versionTxt" id="versionTxt">无法连接网络</div>
					<!--<div class="versionRefresh" @tap="_reconnect">重新连接</div>-->
				</div>
			</div>
			<!--返回上一级-->
			<div class="backTop" @tap = "_backToTop">
				<img src="images/share.jpg" class="contain"/>
				<div class="t_c">
					<i class="iconfont icon-shouqi cor_y"></i>
				</div>
			</div>
			
		</div>

		<script src="./js/mui.min.js"></script>
		<script src="./js/util.js"></script>
		<script src="./js/app.js"></script>
		<script src="./js/vue.js"></script>
		<script src="./js/aes.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/bscroll.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/system.js"></script>
		<!--<script src="js/async.js"></script>-->

		<script type="text/javascript">
		  

			mui.init({
				swipeBack: false
			});
			var APP;
			var activePage;
			var targetPage;
			//			alert('我是更新后的版本')
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
				app.WXinit(CryptoJS);
				app.pushInit();
				APP = new Vue({
					el: '#app',
					data: {
						appHeight: '',
						/*主屏高度*/
						scroll: '',
						/*主页面下拉框*/
						curPos: '',
						/*当前位置*/
						recommend: '',
						/*推荐列表*/
						opacity: 0,
						/*头部的透明控制*/
						newst: [],
						/*最新上架项目*/
						co: '',
						/*当前位置信息*/
						activityPics: [] /*活动轮播图图片*/ ,
						prevPic: '',
						nextPic: '',
						
//						最近上新的分页
						index:1,
						noRest:false,
						total:0,
						
						blockData: [], //豆腐块设计
						noNet: false, //网络状态		
						menusBackgroundPic: '', //menu整块的背景图片
						menusList: [] //分类按钮
					},
					created: function created() {
						app.initHeader();
						//						/*页面首次加载,将登陆默认为0*/
						plus.storage.setItem('isLogin', '0');
					},
					mounted: function mounted() {
						/*初始化主页面的高度*/
						this.appHeight = plus.display.resolutionHeight;
						//						检查是否有网路
						if(!onNet()) {
							//							无网络则跳提示	
							plus.nativeUI.toast('请检查网络');
							this.noNet = true;
							return;
						}

						this._initIndex();

						systemOS.versionInit(function(t) {
							if(t) {
								var isFirst = plus.storage.getItem('isFirst');

								if(!isFirst || isFirst == '0') {
									//																		第一次登陆  打开引导页
									//									mui.openWindow({
									//										id: 'guide',
									//										url: './guide.html',
									//										styles: {
									//											popGesture: "none"
									//										},
									//										show: {
									//											autoShow: true,
									//											aniShow: 'none'
									//										},
									//										waiting: {
									//											autoShow: false
									//										}
									//									});
								} else {}

								//没有更新版本
								mui.later(function() {
									plus.webview.getWebviewById('mine').evalJS('autoLogin()');
									plus.navigator.closeSplashscreen();
								}, 500);
							}
						});
						//新版本检测
					},
					methods: {
						_backToTop:function(){
							this.scroll.scrollTo(0, 0, 300);
						},
						//						重新连接网络
						_reconnect: function _reconnect() {
							//							alert(1)
							this.noNet = false;
							this._initIndex();
						},
						_initIndex: function _initIndex(cb) {
							var _this2 = this;

							/*首页定位*/
							this._initPos(function() {
								/*位置信息获取之后初始化最新上架*/
								_this2._initNew();
								if(cb)cb()
							});
							this._initScroll(); //初始化下拉
							this._initCarousel();
							this._initBlock(); //初始化豆腐块

							this._initMenus(); /*初始化导航栏*/
							
						},

						//						默认头像
						_default: function _default(e) {
							var dom = e.target;
							//							console.log(dom)
							dom.src = "./images/default_avatar.jpg";
						},

						//						初始化豆腐块
						_initBlock: function _initBlock() {
							var _this = this;
							mui.ajax(app.baseUrl + '/api/Carousel/GetPannelList', {
								type: 'get', //HTTP请求类型
								timeout: 5000, //超时时间设置为10秒；
								headers: {
									'Content-Type': 'application/x-www-form-urlencoded',
									"Cache-Control": "max-age=1000000"
								},
								success: function success(result) {

									/*登陆成功*/
									plus.nativeUI.closeWaiting();
									if(result.Success) {
										//										初始化豆腐块
										_this.blockData = result.Data.ListInfo;

										_this.menusBackgroundPic = 'url(' + result.Data.homeFast.menusBackgroundPic + ')';
										//										初始化菜单
										_this.menusList = result.Data.homeFast.menusList;

										//										初始化轮播图
										_this.activityPics = result.Data.bannerData;
										if(result.Data.bannerData.length >= 1) {
											_this.prevPic = _this.activityPics[_this.activityPics.length - 1];
											_this.nextPic = _this.activityPics[0];
										}
										var status = 0;
										_this.activityPics.forEach(function(item, index) {
											var img = new Image();
											img.src = item.LINK_IMAGE;

											img.onload = function() {
												status += 1;
												if(status == result.Data.ListInfo.length) {
//													Lazyimg.lazyLoad();
													mui(slider).slider({
														interval: 3000 //自动播放周期
													});
												}
											};
										});
										//										初始化推荐
										_this.recommend = result.Data.recommendTypes.ListInfo;

										/*推荐项目横向滑动*/
										mui.later(function() {
											_this.recommend.forEach(function(item, index) {
												mui('#wrapper' + index).scroll({
													scrollY: false, //是否竖向滚动
													scrollX: true, //是否横向滚动
													deceleration: 0.0006, //阻尼系数,系数越小滑动越灵敏
													bounce: true, //是否启用回弹
													indicators: false
												});
											});
										}, 500);
									} else {
										/*验证失败*/
									}
								},
								error: function error(xhr, type, errorThrown) {}
							});
						},

						//						跳转活动页面
						_jump: function _jump(str) {
							app._jump(str);
						},

						//						判断定位权限
						_checkPermissionPos: function _checkPermissionPos() {
							var pp = plus.navigator.checkPermission('LOCATION');
							switch(pp) {
								case 'authorized':
									//									plus.nativeUI.alert('已开启定位权限');
									return true;
									break;
								case 'denied':
									plus.nativeUI.alert('已关闭定位权限,请前往设置中打开');
									if(plus.storage.getItem('pos')) {
										return true;
									} else {
										return false;
									}
									break;
								case 'undetermined':
									plus.nativeUI.alert('未确定定位权限,请前往设置中打开');
									if(plus.storage.getItem('pos')) {
										return true;
									} else {
										return false;
									}

									break;
								case 'unknown':
									plus.nativeUI.alert('无法查询定位权限,请前往设置中打开');
									if(plus.storage.getItem('pos')) {
										return true;
									} else {
										return false;
									}
									break;
								default:
									//									plus.nativeUI.alert('不支持定位权限');
									if(plus.storage.getItem('pos')) {
										return true;
									} else {
										return false;
									}
									break;
							}
						},

						/*初始化轮播图*/
						_initCarousel: function _initCarousel() {
							//							var _this = this;
							//							_this.activityPics = [{
							//									LINK_IMAGE: './images/index/banner1.png',
							//									LINK_URL: '-1||'
							//								},
							//								{
							//									LINK_IMAGE: './images/index/banner2.png',
							//									LINK_URL: '-1||'
							//								},
							//								{
							//									LINK_IMAGE: './images/index/banner3.png',
							//									LINK_URL: '-1||'
							//								}
							//							]
							//							_this.prevPic = _this.activityPics[_this.activityPics.length - 1]
							//							_this.nextPic = _this.activityPics[0];
							//							var slider = _this.$refs.slider;
							//
							//							mui(slider).slider({
							//								interval: 3000 //自动播放周期
							//							});
						},

						/*初始化导航栏*/
						_initMenus: function _initMenus() {
							/*返回键监听*/
							var backButtonPress = 0;
							mui.back = function(event) {
								backButtonPress++;
								if(backButtonPress > 1) {
									plus.runtime.quit();
								} else {
									plus.nativeUI.toast('再按一次退出应用');
								}
								setTimeout(function() {
									backButtonPress = 0;
								}, 1000);
								return false;
							};

							// 创建子webview窗口 并初始化
							var aniShow = {};

							//创建原生菜单栏		
							util.initSubpage(aniShow);

							var nview = plus.nativeObj.View.getViewById('tabBar');
							activePage = plus.webview.currentWebview();
							//								targetPage
							var subpages = util.options.subpages;
							var pageW = window.innerWidth;
							var currIndex = 0;

							/**
							 * 根据判断view控件点击位置判断切换的tab
							 */
							nview.addEventListener('click', function(e) {
								//	console.log(plus.webview.currentWebview().id)
								var clientX = e.clientX;
								if(clientX > 0 && clientX <= parseInt(pageW * 0.25)) {
									currIndex = 0;
								} else if(clientX > parseInt(pageW * 0.25) && clientX <= parseInt(pageW * 0.5)) {
									currIndex = 1;
									plus.webview.getWebviewById('community').evalJS('refresh()');
								} else if(clientX > parseInt(pageW * 0.5) && clientX <= parseInt(pageW * 0.75)) {
									currIndex = 2;
									plus.webview.getWebviewById('orders').evalJS('refresh()');
								} else {
									currIndex = 3;
									plus.webview.getWebviewById('orders').evalJS('refresh(true)');
								}
								// 匹配对应tab窗口	
								if(currIndex > 0) {
									targetPage = plus.webview.getWebviewById(subpages[currIndex - 1]);
								} else {
									targetPage = plus.webview.getLaunchWebview();
								}
								//															alert(activePage.id)	
								if(targetPage == activePage) {
									return;
								}
								//底部选项卡切换
								util.toggleNview(currIndex);
								// 子页面切换
								util.changeSubpage(targetPage, activePage, aniShow);
								//更新当前活跃的页面
								activePage = targetPage;
							});
						},

						/*初始化滑动模块*/
						_initScroll: function _initScroll() {
							var _this = this;
							/*初始化下拉scroll*/
							this.$nextTick(function() {
								var scroll = this.$refs.scroll;
								//								var wrapper = this.$refs.wrapper1

								/*页面竖向下拉刷新*/
								if(!_this.scroll) {
									//							初始化标题栏
									_this.scroll = new BScroll(scroll, {
										click: true,
										probeType: 3,
										scrollX: false,
										bounceTime: 200,
										pullDownRefresh: {
											threshold: 80,
											stop: 0
										},
										pullUpLoad: {
											threshold: -20 // 当上拉距离超过30px时触发 pullingUp 事件
										}
									});
								} else {
									_this.scroll.refresh();
								};
								_this.scroll.on('scroll', function(e) {
									var y = e.y;
									if(y > 0) {
										_this.opacity = 0;
										//										
									} else if(y < -200) {
										_this.opacity = 1;
									} else {
										var m = Math.abs(y) / 200;
										_this.opacity = m;
									}
								});

								/*下拉刷新数据*/
								_this.scroll.on('pullingDown', function(e) {
									plus.nativeUI.showWaiting();
									_this._initPos(function() {
										/*位置信息获取之后初始化最新上架*/
										_this._initIndex(function(){
											plus.nativeUI.closeWaiting();
											_this.scroll.finishPullDown();
										});
									});
								});
								/*上拉加载*/
								_this.scroll.on('pullingUp', function(e) {
									_this._initNew(function(b){
//										alert(0)
										if(b){
//											没有数据了												
										}else{
											_this.scroll.finishPullUp();
										}
									});
								});
							});
						},

						/*最近上新*/
						_initNew: function _initNew(callback) {
							var _this = this;
							//							console.log(JSON.stringify(this.co))
							/*获取最新上架列表*/
							mui.ajax(app.baseUrl + '/api/Project/GetProjects', {
								type: 'get', //HTTP请求类型
								timeout: 5000, //超时时间设置为10秒；
								data: {
									ORDER_TYPE: 5,
									distance: 5000,
									pageIndex: _this.index,
									pageSize: 6,
									lon: _this.co.longitude,
									lat: _this.co.latitude
								},
								headers: {
									'Content-Type': 'application/x-www-form-urlencoded'
								},
								success: function success(result) {
									/*登陆成功*/								
									if(result.Success) {
//										_this.newst = result.Data.ListInfo;
										_this.total = result.Data.Total;
										var l = _this.newst.length;										
										if(l == _this.total){
											_this.noRest = true;
//											没有更多数据
											if(callback) callback(true);
										}else{
											
											_this.index += 1;
											_this.newst = _this.newst.concat(result.Data.ListInfo);
											_this.scroll.refresh();
											if(callback) callback(false);
										}								
									} else {
										/*验证失败*/
									}
								},
								error: function error(xhr, type, errorThrown) {
									//异常处理；
									app.catchErr(type);
								}
							});
						},

						/*菜单页面*/
						_menuTo: function _menuTo(type, extras) {
							var r = this._checkPermissionPos();
							//							alert(r)
							//							跳转菜单页面必须要有定位信息
							if(!r) {
								if(mui.os.android) {
									var main = plus.android.runtimeMainActivity(); //获取activity
									var Intent = plus.android.importClass('android.content.Intent');
									var Settings = plus.android.importClass('android.provider.Settings');
									var intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS); //可设置表中所有Action字段
									main.startActivity(intent);
								}

								if(mui.os.ios) {
									var UIApplication = plus.ios.import("UIApplication");
									var NSURL = plus.ios.import("NSURL");
									var setting = NSURL.URLWithString("app-settings:");
									var application = UIApplication.sharedApplication();
									application.openURL(setting);
									plus.ios.deleteObject(setting);
									plus.ios.deleteObject(application);
								}

								return;
							}

							if(!plus.storage.getItem('pos')) {
								plus.nativeUI.toast('位置获取失败,请刷新或者尝试手动获取');
								return;
							}

							if(type != '1') {
								return;
							}

							var desturl = './html/production/productList.html';
							var destid = 'productList';
							var exa = {
								proType: extras
							};
							var option = {
								autoWaiting: false
							};
							app.navigater(desturl, destid, exa, option);
						},
						_NWnavigateTo: function _NWnavigateTo(desturl, destid, extras) {

							var exa = extras;
							var option = {};
							app.navigater(desturl, destid, exa, option);
						},

						//						带有导航栏的跳状
						_NTnavigateTo: function _NTnavigateTo(desturl, destid, extras) {
							var exa = extras;
							var option = {
								showTitle: true,
								autoWaiting: false
							};
							app.navigater(desturl, destid, exa, option);
						},

						/*初始化位置*/
						_initPos: function _initPos(callback) {
							var _this = this;
							plus.geolocation.getCurrentPosition(function(position) {
								if(!position || !position.address || !position.address.city) return;
								var obj = position.address;
								//								console.log(JSON.stringify(position))
								_this.co = {
									longitude: position.coords.longitude,
									/*经度*/
									latitude: position.coords.latitude,
									/*纬度*/
									address: obj.city + position.address.street
								};

								plus.storage.setItem('pos', JSON.stringify(_this.co));

								if(callback) callback();

								var add = obj.city + position.address.street;
								_this.curPos = add;
							}, function() {
								plus.nativeUI.toast('位置获取失败,请手动获取');
								if(callback) callback();
								plus.nativeUI.closeWaiting();
							}, {
								enableHighAccuracy: false,
								timeout: function timeout() {
									plus.nativeUI.toast('信号不佳，位置获取失败');
								}
							});
						}
					}
				});
			});
			/*制定底部显示的tab页面*/
			function switchMenu(key) {
				//				alert(1)
				key = parseInt(key);
				activePage = plus.webview.currentWebview();
				//				alert(activePage.id)
				var subpages = util.options.subpages;
				if(key > 0) {
					targetPage = plus.webview.getWebviewById(subpages[key - 1]);
				} else {
					targetPage = plus.webview.currentWebview();
				}
				if(targetPage == activePage) {
					return;
				}
				//底部选项卡切换
				util.toggleNview(key);
				// 子页面切换
				util.changeSubpage(targetPage, activePage, {});
				//更新当前活跃的页面
				activePage = targetPage;
				//				alert(activePage.id)
			}
			/*回传位置信息*/
			function setPos(str) {
				APP.curPos = str;
				APP.co = JSON.parse(plus.storage.getItem('pos'));
				//				console.log(plus.storage.getItem('pos'))
				APP._initNew();
			}
			//			关闭等待
			function closeVersion() {
				if(document.getElementById('version')) {
					mui.later(function() {
						document.getElementById('version').style.display = 'none';
					}, 500);
				}
			}
			//			外链的回掉跳转 作品详情页
			function _navigateToPro(code) {
				var desturl = './html/production/productBuy.html';
				var destid = 'productBuy';
				var exa = {
					proKey: code
				};
				var option = {
					showTitle: false
				};
				app.navigater(desturl, destid, exa, option);
			}
//			(function(lazyimg) {
//
//				lazyimg.lazyLoad = function(doc, cb) {
//
//					lazyLoad(doc ? doc : document);
//				};
//				var lazyLoad = function lazyLoad(doc, cb) {
//					//					
//					var imgs = doc.querySelectorAll('img.lazy');
//					mui.each(imgs, function(index,img) {
//						var data_src = img.getAttribute('data-src');
//						//						alert(data_src)
//						if(data_src && data_src.indexOf('https://') >= 0) {
//							common.cache.getFile(data_src, function(localUrl) {
//								setPath(img, localUrl);
//							});
//						}
//					});
//				};
//
//				function setPath(img, src) {
//					//					alert(src)
//					img.setAttribute('src', src);
//					img.classList.remove("lazy");
//				}
//			})(window.Lazyimg = {});

			document.addEventListener("netchange", onNetChange, false);

			function onNetChange() {
				//获取当前网络类型

				var nt = plus.networkinfo.getCurrentType();
				switch(nt) {
					case plus.networkinfo.CONNECTION_ETHERNET:
						APP._reconnect();
						break;
					case plus.networkinfo.CONNECTION_WIFI:
						//					alert(0)

						APP._reconnect();
						break;
					case plus.networkinfo.CONNECTION_CELL2G:
						APP._reconnect();
						break;
					case plus.networkinfo.CONNECTION_CELL3G:
						APP._reconnect();
						break;
					case plus.networkinfo.CONNECTION_CELL4G:
						APP._reconnect();
						break;
					default:
						//						mui.toast("当前没有网络");　　

						plus.nativeUI.alert("网络异常，请检查");
						APP.noNet = true;
						break;
				}
			}

			function onNet(urlstr) {
				var nt = plus.networkinfo.getCurrentType();
				if(nt == plus.networkinfo.CONNECTION_NONE) {
					return false;
				} else {
					//连接网络
					return true;
				}
			}
		</script>
	</body>

</html>